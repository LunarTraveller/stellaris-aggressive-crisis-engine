namespace = acemod_core
event = {
	id = acemod_core.1
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		set_global_flag = acemod_installed
	}
}

# test event - calculate
country_event = {
	id = acemod_core.2
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_system_within_border = {
			limit = {
				exists = owner
			}
			acemod_calculate_solar_system_target_value = yes
		}
	}
}

# test event - recalculate
country_event = {
	id = acemod_core.3
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_system_within_border = {
			limit = {
				exists = owner
			}
			acemod_recalculate_solar_system_target_value = yes
		}
	}
}

# test event - launch all fleets
event = {
	id = acemod_core.4
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = acemod_activated
	}
	immediate = {
		every_country = {
			limit = {
				OR = {
					is_country_type = swarm
					is_country_type = extradimensional
					is_country_type = extradimensional_2
					is_country_type = extradimensional_3
					is_country_type = ai_empire
					is_country_type = gray
					is_country_type = gray_goo					# A Deadly Tempest mod
				}
			}
			every_owned_fleet = {
				limit = {
					NOT = {
						has_fleet_flag = acemod_event_target_invader_fleet_active
					}
					is_ship_class = shipclass_military
				}
				acemod_find_solar_system_target_neighbor = yes
			}
		}
	}
}

# test event - activate custom AI
event = {
	id = acemod_core.5
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		set_global_flag = acemod_activated
	}
}

# test event - launch all fleets
destroy_colony = yes
# wait 30 days
fleet_event = {
	id = acemod_core.100
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = acemod_activated
		owner = {
			OR = {
				is_country_type = swarm
				is_country_type = extradimensional
				is_country_type = extradimensional_2
				is_country_type = extradimensional_3
				is_country_type = ai_empire
				is_country_type = gray
				is_country_type = gray_goo				# A Deadly Tempest mod
			}
		}
		is_ship_class = shipclass_military
	}
	immediate = {
		fleet_event = {
			id = acemod_core.101
			days = 75
		}
		solar_system = {
			# for testing purposes
			every_system_planet = {
				limit = {
					is_colony = yes
				}
				destroy_colony = yes
			}
		}
	}
}

# redirect fleet
fleet_event = {
	id = acemod_core.101
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		if = {
			limit = {
				solar_system = {
					has_star_flag = acemod_star_flag_solar_system_target
				}
			}
			clear_fleet_actions = this
		}
		acemod_find_solar_system_target_neighbor = yes
	}
}

# redirect fleet
# fleet_event = {
# 	id = acemod_core.102
# 	hide_window = yes
# 	is_triggered_only = yes
# 	trigger = {
# 		NOR = {
# 			has_fleet_flag = acemod_event_target_invader_fleet_active
# 			has_fleet_order = move_to_system_point_order
# 			has_fleet_order = orbit_planet_order
# 			has_fleet_order = follow_order
# 		}
# 	}
# 	immediate = {
# 		clear_fleet_actions = this
# 		solar_system = {
# 			closest_system = {
# 				min_steps = 1
# 				max_steps = 10
# 				limit = {
# 					has_access_fleet = root.owner
# 					NOT = {
# 						has_star_flag = extradimensional_origin_system
# 					}
# 					any_fleet_in_system = {
# 						count = 1
# 						owner = {
# 							is_same_value = prev.root
# 						}
# 					}
# 				}
# 				random_fleet_in_system = {
# 					limit = {
# 						OR = {
# 							AND = {
# 								owner = {
# 									is_same_value = prev.root
# 								}
# 								OR = {
# 									is_in_combat = yes
# 									has_fleet_order = combat_order
# 								}
# 							}
# 							owner = {
# 								is_same_value = prev.root
# 							}
# 						}
# 					}
# 					save_event_target_as = acemod_event_target_invader_reinforcement_target
# 				}
# 			}
# 		}
# 		auto_follow_fleet = {
# 			target = event_target:acemod_event_target_invader_reinforcement_target
# 			attack_fleet = no
# 		}
# 	}
# }